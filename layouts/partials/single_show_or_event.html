{{/* show starts on the first date in the showtimes array */}}
{{- $start := (time (index .Params.showtimes 0).time ) -}}
{{/* show ends on the last date in the showtimes array */}}
{{- $end := (time (index .Params.showtimes (sub (len .Params.showtimes) 1) ).time ) -}}

{{- $.Scratch.Set "posterPath" nil -}}
{{- range (readDir (printf "content/%s" .RelPermalink)) -}}
    {{- if hasPrefix .Name "poster" -}}
        {{- $.Scratch.Set "posterPath" .Name -}}
    {{- end -}}
{{- end -}}
<div class="container {{ .Type }}-single">
	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-4 col-lg-3">
			<img src="{{ $.Scratch.Get "posterPath" }}" />
            <span
                id="fb_share_button"
                data-permalink="{{ .Permalink }}"
                class="fa fa-facebook"
                aria-hidden="true"></span>
			<ul class="social-icons">
				<li><a href="https://twitter.com/intent/tweet?url={{ .Permalink }}&amp;text={{ .Title }} &middot; {{ .Site.Title }}&amp;via={{ .Site.Params.social.twitter }}&amp;hashtags=bpp,newplays">
					<span class="fa fa-twitter" aria-hidden="true"></span>
				</a></li>
			    <li><a href="https://pinterest.com/pin/create/bookmarklet/?media={{ .Permalink }}{{ $.Scratch.Get "posterPath" }}&amp;url={{ .Permalink }}&amp;is_video=0&amp;description={{ .Title }} &middot; {{ .Site.Title }}">
			  	    <span class="fa fa-pinterest-p" aria-hidden="true"></span>
			    </a></li>
                {{ with .Params.youtube_id }}
			    <li><a href="https://youtu.be/{{ . }}">
			  	    <span class="fa fa-youtube" aria-hidden="true"></span>
			    </a></li>
                {{ end }}
			</ul>
            <div
                class="fb-share"
                data-share="true"
                data-width="450"
                data-show-faces="true">
            </div>
		</div>
		<div class="col-xs-12 col-sm-12 col-md-8 col-lg-5">
			<h1>{{ .Title }}</h1>
			{{/* only show the subtitle if it exists */}}
			{{- if .Params.subtitle -}}
                <h6 class="subtitle">{{ .Params.subtitle }}</h6>
			{{- end -}}
			<div class="meta">
				{{ if .Params.genres }}
    				{{ $links := apply .Params.genres "partial" "genre/link.html" "." }}
    				<p>
    					Genre{{ if gt (len .Params.genres) 1 }}s{{ end }}:
    					{{ delimit $links  ", " " & " }}
    				</p>
				{{ end }}
				{{ if .Params.playwrights }}
    				{{ $links := apply .Params.playwrights "partial" "bio/link.html" "." }}
    				<p>
    				  Playwright{{ if gt (len .Params.playwrights) 1 }}s{{ end }}:
    				  {{ delimit $links  ", " " & " }}
    				</p>
				{{ end }}
				{{ if .Params.musicians }}
    				{{ $links := apply .Params.musicians "partial" "bio/link.html" "." }}
    				<p>
    				  Music:
    				  {{ delimit $links  ", " " & " }}
    				</p>
				{{ end }}
				{{ if .Params.lyricists }}
    				{{ $links := apply .Params.lyricists "partial" "bio/link.html" "." }}
    				<p>
    					Lyrics:
    					{{ delimit $links  ", " " & " }}
    				</p>
				{{ end }}
				{{ if .Params.directors }}
    				{{ $links := apply .Params.directors "partial" "bio/link.html" "." }}
    				<p>
    				  Director{{ if gt (len .Params.directors) 1 }}s{{ end }}:
    				  {{ delimit $links ", " " & " }}
    				</p>
			    {{ end }}
			    {{ if (index .Params "set designers" ) }}
			        {{ $links := apply (index .Params "set designers" ) "partial" "bio/link.html" "." }}
                    <p>
                        Set Designer{{ if gt (len (index .Params "set designers" )) 1 }}s{{ end }}:
                        {{ delimit $links ", " " & " }}
                    </p>
			    {{ end }}
			    {{ if (index .Params "stage managers" ) }}
			        {{ $links := apply (index .Params "stage managers" ) "partial" "bio/link.html" "." }}
                    <p>
                        Stage Manager{{ if gt (len (index .Params "stage managers" )) 1 }}s{{ end }}:
                        {{ delimit $links ", " " & " }}
                    </p>
			    {{ end }}
			    {{ if (index .Params "lighting designers" ) }}
			        {{ $links := apply (index .Params "lighting designers" ) "partial" "bio/link.html" "." }}
			        <p>
			            Lighting Designer{{ if gt (len (index .Params "lighting designers" )) 1 }}s{{ end }}:
			            {{ delimit $links ", " " & " }}
			        </p>
			    {{ end }}
			    {{ if (index .Params "costume designers" ) }}
			        {{ $links := apply (index .Params "costume designers" ) "partial" "bio/link.html" "." }}
		            <p>
		                Costume Designer{{ if gt (len (index .Params "costume designers" )) 1 }}s{{ end }}:
			            {{ delimit $links ", " " & " }}
			        </p>
			    {{ end }}
			    {{ if (index .Params "sound designers" ) }}
			        {{ $links := apply (index .Params "sound designers" ) "partial" "bio/link.html" "." }}
                    <p>
                        Sound Designer{{ if gt (len (index .Params "sound designers" )) 1 }}s{{ end }}:
                        {{ delimit $links ", " " & " }}
                    </p>
                {{ end }}
			</div>

			<p>{{ .Content }}</p>

		</div>
		<div class="col-xs-12 col-sm-12 col-md-8 col-lg-4 pull-right">
			{{ partial "youtube.html" . }}
			<div class="times">
				{{ if gt $end.Unix .Now.Unix }}
					<h6>See It Live</h6>
				{{ else }}
					<h6>Performed Live</h6>
				{{ end }}

				{{ partial "show/dates.html" . }}

				{{ if gt $end.Unix .Now.Unix }}
                    {{ with .Params.tickets_run }}
    					<div>
    						<a class="button button-secondary" href="{{ . }}">
                                Buy Tickets
                            </a>
    					</div>
                    {{ end }}
				{{ end }}
			</div>
		</div>

	</div>
</div>
